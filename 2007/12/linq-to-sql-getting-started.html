<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="/images/favicon.png" />
    <style>
    html,body,li,p{margin:0;padding:0}p,ul,ol,.highlight{margin:1.6em 0}h1,h2,h3,h4{margin:0;padding:0;font-size:100%;font-weight:bold;text-rendering:optimizeLegibility;font-family:sans-serif}ul{list-style:none}html{box-sizing:border-box;font-size:62.5%}*{box-sizing:inherit}*:before,*:after{box-sizing:inherit}img{height:auto;max-width:100%}pre,code{font-family:monospace;margin:0}hr{display:block;height:1px;border:0;border-top:1px solid #efefef;margin:1rem 0;padding:0}blockquote{font-style:italic;margin:1.6em 0 1.6em -2.2em;padding:0 0 0 1.6em;border-left:#4a4a4a 0.4em solid}html{font-size:16px}@media screen and (min-width: 900px){html{font-size:18px}}@media screen and (min-width: 1200px){html{font-size:20px}}body{font-family:serif;color:#3A4145}h1{font-size:2rem;margin:10px 0 10px 0;letter-spacing:-1px}h2{font-size:1.4rem;letter-spacing:-1px}h3{font-size:1.2rem}h4{font-size:1.1rem}a:link,a:visited{color:inherit;text-decoration:none}a:hover{color:#57A3E8;transition:color ease 0.3s}p a:link,p a:visited{text-decoration:underline}pre{border:1px solid #E3EDF3;padding:10px;font-size:0.85em;border-radius:3px}code{padding:1px 3px;font-size:0.85em;white-space:pre;border:1px solid #E3EDF3;background:#F7FAFB;border-radius:2px}pre code{background:transparent;padding:0;border:0}.m-h{text-align:center;background-color:#303538;color:#fff;padding:1rem}.m-h h2{font-weight:normal;font-size:1.5rem}article{width:80%;margin:1rem auto;padding-bottom:1rem;border-bottom:#EBF2F6 1px solid;word-break:break-word;position:relative}article::after{display:block;content:"";width:7px;height:7px;border:#E7EEF2 1px solid;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;box-shadow:#fff 0 0 0 5px}.a-m{color:#9EABB3;font-size:0.8rem}.a-m a:hover{color:#9EABB3;text-decoration:underline}.a-h{margin-bottom:5px}.r-m{font-size:smaller}nav{position:relative;width:75%;margin:1rem auto;font-size:0.8rem;color:#9EABB3;text-align:center}.m-f{position:relative;margin:2rem 0 0 0;padding:1rem 1rem 2rem 1rem;border-top:#EBF2F6 1px solid;font-size:0.8rem;line-height:1.7em;color:#BBC7CC;text-align:center;background:#F7FAFB}.o-p,.n-p{position:absolute;display:inline-block;padding:0 0.5rem;border:#EBF2F6 2px solid;text-decoration:none;border-radius:30px;transition:border ease 0.3s}.o-p{right:0}.n-p{left:0}.t-h{width:80%;margin:0 auto}.highlight pre{background-color:#49483e;color:white;overflow:scroll}.ge{font-style:italic}.gs{font-weight:bold}.c,.cm,.cp,.c1,.gu,.cs{color:#75715e}.k,.kc,.kd,.kp,.kr,.no,.kt{color:#66d9ef}.l,.mf,.mh,.mi,.mo,.se,.il,.m{color:#ae81ff}.n,.nb,.ni,.nl,.nn,.py,.nv,.w,.bp,.vc,.vg,.vi,.p{color:#f8f8f2}.o,.nt,.ow,.gd,.kn{color:#f92672}.ld,.sb,.sc,.sd,.s2,.sh,.si,.sx,.sr,.s1,.ss,.s{color:#e6db74}.na,.nc,.nd,.ne,.nf,.nx,.gi{color:#a6e22e}

    </style>

    <!-- Begin Jekyll SEO tag v2.0.0 -->
<title>LINQ to SQL: Getting Started - Chris Sainty</title>
<meta property="og:title" content="LINQ to SQL: Getting Started" />
<meta name="description" content="I am going to start by showing a few new language features that are important to LINQ (and hence LINQ-to-SQL) that you may not have come across yet if you are not already playing around with this stuff." />
<meta property="og:description" content="I am going to start by showing a few new language features that are important to LINQ (and hence LINQ-to-SQL) that you may not have come across yet if you are not already playing around with this stuff." />
<link rel="canonical" href="https://blog.csainty.com/2007/12/linq-to-sql-getting-started.html" />
<meta property="og:url" content="https://blog.csainty.com/2007/12/linq-to-sql-getting-started.html" />
<meta property="og:site_name" content="Chris Sainty" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2007-12-27T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@csainty" />
<meta name="twitter:creator" content="@Chris Sainty" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "LINQ to SQL: Getting Started",
    "datePublished": "2007-12-27T00:00:00+00:00",
    "description": "I am going to start by showing a few new language features that are important to LINQ (and hence LINQ-to-SQL) that you may not have come across yet if you are not already playing around with this stuff.",
    "url": "https://blog.csainty.com/2007/12/linq-to-sql-getting-started.html"
  }
</script>
<!-- End Jekyll SEO tag -->
</head>
<body>
  <header class="m-h">
    <h1><a href="https://blog.csainty.com">Chris Sainty</a></h1>
    <h2>A technical blog covering full-stack web development.</h2>
    <h2><a href="https://twitter.com/csainty" rel="external">twitter</a> | <a href="https://github.com/csainty" rel="external">github</a> | <a href="https://stackoverflow.com/users/625695/chris-sainty" rel="external">stackoverflow</a></h2>
  </header>

  <article>
    <span><time datetime="27 Dec 2007">27 Dec 2007</time>  </span>
    <h1>LINQ to SQL&#58; Getting Started</h1>
    <section>
        <p>I am going to start by showing a few new language features that are important to LINQ (and hence LINQ-to-SQL) that you may not have come across yet if you are not already playing around with this stuff.</p>

<!-- more -->

<p>A great place to start is to bring up intellisense and have a look at the structure of the classes that have been created for you.</p>

<p><img src="/images/1382874053760.png" alt="Intellisense"> </p>

<p>Each table in the database is given a property on the <code>DataContext</code> object. The type of this property (using <code>Addresses</code> as the example) will be <code>System.Data.Linq.Table&lt;Address&gt;</code>. This class implements the <code>IEnumerable&lt;&gt;</code> and <code>IQueryable&lt;&gt;</code> interfaces that provides the underlying LINQ functionality.</p>

<p><img src="/images/1382874053761.png" alt="IEnumerable"> </p>

<p>You will note a <code>Count()</code> method here, as well as a number of other interesting functions such as <code>Average()</code>, <code>Contains()</code> and <code>DeleteAllOnSubmit()</code>. We will take a look at a number of these later. First however I want to talk about what the <code>&lt;&gt;</code> symbols that are being scattered around.  </p>

<p>When we define a class, for example List, as <code>List&lt;MyCustomClass&gt;</code> it tells the compiler that this List instance should substitute MyCustomClass for object in its definition. The actual definition of the List class decides where and how the Type is used, but we will not go into that detail here. What this means is that you can have a List whose methods will take/return the objects of type <code>MyCustomClass</code> without messing around with casting to/from object or creating a custom sub-class.<br>
This technique is used heavily in LINQ-to-SQL to provide strong compile time type checking.<br>
What this means for you in practice is that if you try to add an <code>Order</code> record to the <code>Address</code> table, it will pick this mistake up at compile-time, not with a run-time error.
Now lets put a few things together and add a record to one of the tables.</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">private</span> <span class="k">void</span> <span class="nf">button1_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AdventureWorksDataContext</span><span class="p">();</span>
    <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">AddressTypes</span><span class="p">.</span><span class="nf">Count</span><span class="p">().</span><span class="nf">ToString</span><span class="p">());</span> <span class="c1">// 6
</span>    <span class="kt">var</span> <span class="n">x</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AddressType</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Name</span><span class="p">=</span> <span class="s">"New Address Type"</span><span class="p">,</span>
        <span class="n">ModifiedDate</span><span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span>
    <span class="p">};</span>
    <span class="n">db</span><span class="p">.</span><span class="n">AddressTypes</span><span class="p">.</span><span class="nf">InsertOnSubmit</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>    <span class="c1">// Queues up an insert
</span>    <span class="n">db</span><span class="p">.</span><span class="nf">SubmitChanges</span><span class="p">();</span>    <span class="c1">// Submits all the changes in a single transaction
</span>    <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">MessageBox</span><span class="p">.</span><span class="nf">Show</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">AddressTypes</span><span class="p">.</span><span class="nf">Count</span><span class="p">().</span><span class="nf">ToString</span><span class="p">());</span> <span class="c1">// 7
</span><span class="p">}</span>
</code></pre></div>
<p>The first question, some may ask, is what is that <code>var</code> keyword. Well rest easy, C# has not introduced some new variant type, var tells the compiler to look at the assignment expression and determine the type to assign to the new variable. <code>var x = new AddressType()</code> is absolutely identical to <code>AddressType x = new AddressType(),</code> its just cleaner to read and easier to write. It has one other use, that we will see later. </p>

<p>Also of interest is the way I have set the property values for my new <code>AddressType</code> record. Again this is just a cleaner way of setting up a class and assigning properties to it. </p>

<p>You gain no benefit from using either of these new tricks other than cleaner (in my opinion) code. 
Let&#39;s now put together something a little more complex (and contrived) </p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">private</span> <span class="k">void</span> <span class="nf">button1_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AdventureWorksDataContext</span><span class="p">();</span>
    <span class="n">db</span><span class="p">.</span><span class="n">Log</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="n">Out</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="k">from</span> <span class="n">c</span> <span class="k">in</span> <span class="n">db</span><span class="p">.</span><span class="n">Customers</span>
                <span class="k">where</span> <span class="n">c</span><span class="p">.</span><span class="n">CustomerAddresses</span><span class="p">.</span><span class="nf">Count</span><span class="p">(</span><span class="n">a</span> <span class="p">=&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">Address</span><span class="p">.</span><span class="n">City</span> <span class="p">==</span> <span class="s">"Seattle"</span><span class="p">)</span> <span class="p">&gt;</span> <span class="m">0</span>
                <span class="k">select</span> <span class="k">new</span> 
                <span class="p">{</span> 
                    <span class="n">AccountNumber</span><span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">AccountNumber</span><span class="p">,</span>
                    <span class="n">SaleValue</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">SalesOrderHeaders</span><span class="p">.</span><span class="nf">Sum</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="n">o</span><span class="p">.</span><span class="n">SubTotal</span><span class="p">)</span>
                <span class="p">};</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">customer</span> <span class="k">in</span> <span class="n">query</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="n">AccountNumber</span> <span class="p">+</span> <span class="s">" - "</span> <span class="p">+</span> <span class="n">customer</span><span class="p">.</span><span class="n">SaleValue</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>First things first, by hooking up <code>db.Log</code> to <code>Console.Out</code>, we can see the SQL statements that are being executed. You can just as easily hook this up to output to a file.<br>
What this statement does is find customers with an address in <code>Seattle</code>, and sum up their orders. There are two new features here that need to be discussed. </p>

<p>*First we have the Lambda Expression <code>a =&gt; a.City == &quot;Seattle&quot;</code>. Lambda Expressions basically offer and in-line delegate method. In the case of the <code>Count()</code> method, you can pass it an expression that will take one parameter (in this case <code>a</code>) of type <code>CustomerAddress</code> (<code>CustomerAddresses</code> is an <code>IEnumerable&lt;CustomerAddress&gt;</code>) and return a boolean value to indicate whether this element in the collection should be counted. Because intellisense knows the type of <code>a</code> from the definition of the class, it gives you full support. Exactly how a.Address works, we will see later, suffice to say there is no <code>Address</code> field in the <code>CustomerAdress</code> table, but there is a relationship from <code>CustomerAddress</code> to <code>Address</code> defined in the database schema. </p>

<p>Second we have the <code>select new {}</code> piece of code, you will note this uses a similar constructor to what I used above when creating my <code>AddressType</code> object, in this case we are actually creating an in-line type definition. Our type will have two properties, that we use in the <code>foreach</code> loop below, and comes with full intellisense support!! </p>

<p>This is where the <code>var</code> keyword really comes into play, because we are defining an Anonymous Type, we do not actually have a type we can provide up-front when declaring our object, but the compiler can use the expression to determine the type and provide us with intellisense and type checking.</p>

<p>Another point worth noting is that the LINQ syntax is just a wrapper for the underlying IEnumerable/IQueryable methods and that statements can be written using either.</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Customers</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">CustomerAddresses</span><span class="p">.</span><span class="nf">Count</span><span class="p">(</span><span class="n">a</span> <span class="p">=&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">Address</span><span class="p">.</span><span class="n">City</span> <span class="p">==</span> <span class="s">"Seattle"</span><span class="p">)</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="p">{</span> <span class="n">AccountNumber</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">AccountNumber</span><span class="p">,</span> <span class="n">SaleValue</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">SalesOrderHeaders</span><span class="p">.</span><span class="nf">Sum</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="n">o</span><span class="p">.</span><span class="n">SubTotal</span><span class="p">)</span> <span class="p">});</span>
</code></pre></div>
<p>Last of all, lets see the output generated. I hope you will agree they have done a fantastic job converting a rather obtuse query like the one above into solid SQL.</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="p">[</span><span class="n">t0</span><span class="p">].[</span><span class="n">AccountNumber</span><span class="p">],</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="k">SUM</span><span class="p">([</span><span class="n">t3</span><span class="p">].[</span><span class="n">SubTotal</span><span class="p">])</span>
    <span class="k">FROM</span> <span class="p">[</span><span class="n">Sales</span><span class="p">].[</span><span class="n">SalesOrderHeader</span><span class="p">]</span> <span class="k">AS</span> <span class="p">[</span><span class="n">t3</span><span class="p">]</span>
    <span class="k">WHERE</span> <span class="p">[</span><span class="n">t3</span><span class="p">].[</span><span class="n">CustomerID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">t0</span><span class="p">].[</span><span class="n">CustomerID</span><span class="p">]</span>
    <span class="p">)</span> <span class="k">AS</span> <span class="p">[</span><span class="n">SaleValue</span><span class="p">]</span>
<span class="k">FROM</span> <span class="p">[</span><span class="n">Sales</span><span class="p">].[</span><span class="n">Customer</span><span class="p">]</span> <span class="k">AS</span> <span class="p">[</span><span class="n">t0</span><span class="p">]</span>
<span class="k">WHERE</span> <span class="p">((</span>
    <span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
    <span class="k">FROM</span> <span class="p">[</span><span class="n">Sales</span><span class="p">].[</span><span class="n">CustomerAddress</span><span class="p">]</span> <span class="k">AS</span> <span class="p">[</span><span class="n">t1</span><span class="p">]</span>
    <span class="k">INNER</span> <span class="k">JOIN</span> <span class="p">[</span><span class="n">Person</span><span class="p">].[</span><span class="n">Address</span><span class="p">]</span> <span class="k">AS</span> <span class="p">[</span><span class="n">t2</span><span class="p">]</span> <span class="k">ON</span> <span class="p">[</span><span class="n">t2</span><span class="p">].[</span><span class="n">AddressID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">t1</span><span class="p">].[</span><span class="n">AddressID</span><span class="p">]</span>
    <span class="k">WHERE</span> <span class="p">([</span><span class="n">t2</span><span class="p">].[</span><span class="n">City</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="n">p0</span><span class="p">)</span> <span class="k">AND</span> <span class="p">([</span><span class="n">t1</span><span class="p">].[</span><span class="n">CustomerID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">t0</span><span class="p">].[</span><span class="n">CustomerID</span><span class="p">])</span>
    <span class="p">))</span> <span class="o">&gt;</span> <span class="o">@</span><span class="n">p1</span>
<span class="c1">-- @p0: Input NVarChar (Size = 7; Prec = 0; Scale = 0) [Seattle]</span>
<span class="c1">-- @p1: Input Int (Size = 0; Prec = 0; Scale = 0) [0]</span>

<span class="n">AW00000001</span> <span class="o">-</span> <span class="mi">102351</span><span class="p">.</span><span class="mi">7966</span>
<span class="n">AW00000146</span> <span class="o">-</span> <span class="mi">872520</span><span class="p">.</span><span class="mi">1608</span>
<span class="n">AW00000236</span> <span class="o">-</span> <span class="mi">649987</span><span class="p">.</span><span class="mi">2813</span>
<span class="n">AW00000397</span> <span class="o">-</span> <span class="mi">178854</span><span class="p">.</span><span class="mi">5230</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
</code></pre></div>
<p>That will cover us for this article. Next I am going to take a step back from the code and talk a little about the mind set you should be using with LINQ-to-SQL and hopefully help you understand just why I am so excited by it.</p>

    </section>
</article>


  <footer class="m-f">
      <section class="copyright">All content copyright <a href="/">Chris Sainty</a> &copy; 2006-2017 &bull; All rights reserved.</section>
  </footer>
</body>
</html>
